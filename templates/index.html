<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App</title>
    <style>
        .hidden {
            display: none;
        }
        ul {
            list-style-type: none;
        }
    </style>
</head>
<body>
    <div id="error" class="hidden">
        Something went wrong!
    </div>
    <ul id="todo">
        {% for d in data %}
        <li><input type="checkbox" class="check-completed" {% if d.completed %} checked {% endif %}> {{ d.description }}</li>
        {% endfor %}
    </ul>
    <br>
    <form id="form">
        <div>
            <label for="desc">Enter todo: </label>
            <input type="text" name="description" id="desc">
        </div>
        <input type="submit" value="Add">
    </form>


    <!-- Javascript -->
    <script>
        // esversion: 6
        const checkboxes = document.querySelectorAll('.check-completed');
        for (let i = 0; i < checkboxes.length; i++) {
            const checkbox = checkboxes[i];
            checkbox.onchange = function(e) {
                console.log('event', e);
                const newCompleted = e.target.checked;
                fetch("/todos/set-completed", {
                    method: 'POST',
                    body: JSON.stringify({
                        'completed': newCompleted
                    }),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
            }
        }
        document.getElementById("form").onsubmit = function(e) {
            e.preventDefault();
            fetch("/todos/create", {
                method: "POST",
                body: JSON.stringify({
                    'description': document.getElementById("desc").value
                }),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(res => res.json())
            .then(jsonResponse => {
                // console.log(jsonResponse);
                liItem = document.createElement('li');
                liItem.innerHTML = jsonResponse.description;
                document.getElementById('todo').appendChild(liItem);
                document.getElementById("error").className = "hidden";
            })
            .catch(() => {
                document.getElementById("error").className = "";
            })
        }
    </script>
</body>
</html>